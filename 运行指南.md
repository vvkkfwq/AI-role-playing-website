# 程序运行指南

## 🚀 快速启动

### 1. 环境准备

```bash
# 克隆项目
git clone <repository-url>
cd AI-role-playing-website

# 安装 Python 依赖
pip install -r requirements.txt

# 安装音频处理依赖
# macOS:
brew install ffmpeg

# Ubuntu/Debian:
sudo apt update && sudo apt install ffmpeg

# Windows:
# 下载 ffmpeg 并添加到 PATH 环境变量
```

### 2. 配置 API 密钥

```bash
# 复制环境变量模板
cp .env.example .env

# 编辑 .env 文件，设置你的 OpenAI API Key
OPENAI_API_KEY=your_openai_api_key_here
OPENAI_MODEL=gpt-4o-mini
```

### 3. 运行程序

```bash
# 推荐方式：使用启动脚本（自动检查依赖和初始化数据库）
python run.py

# 或者直接运行 Streamlit
streamlit run app/main.py
```

### 4. 访问应用

打开浏览器访问：`http://localhost:8501`

## 🔧 常用命令

### 数据库管理

```bash
# 重置数据库并创建示例数据
python scripts/init_database.py --reset --sample-data

# 或使用启动脚本重置
python run.py --reset --sample-data
```

### 功能测试

```bash
# 测试数据库功能
python tests/test_database.py

# 测试音频功能
python tests/test_audio.py

# 测试语音转文本
python tests/test_stt.py

# 测试文本转语音
python tests/test_tts.py
```

## ⚠️ 常见问题

1. **无法录音**：确保浏览器允许麦克风访问权限
2. **音频功能异常**：检查 ffmpeg 是否正确安装
3. **API 调用失败**：检查 `.env` 文件中的 OpenAI API Key 是否正确
4. **依赖安装失败**：尝试使用 `pip install -r requirements.txt --force-reinstall`

## 🎭 使用说明

1. **选择角色**：在左侧边栏选择哈利·波特、苏格拉底或爱因斯坦
2. **开始对话**：在聊天框输入文字或点击录音按钮进行语音输入
3. **保存对话**：点击"保存对话"按钮保存当前会话
4. **查看历史**：切换到"对话历史"标签查看过往对话

## 🎯 核心功能

### AI 智能技能系统
- **情感支持**：自动识别情绪并提供角色专属的情感支持
- **深度对话**：苏格拉底式提问，引导深入思考
- **故事创作**：个性化故事讲述功能
- **智能推荐**：基于对话内容推荐适合的技能

### 语音功能
- **语音输入**：支持录音转文字（Speech-to-Text）
- **语音合成**：角色专属语音回复（Text-to-Speech）
- **多种声音**：支持 6 种不同的 OpenAI 语音选项
- **智能缓存**：自动缓存常用语音，提升响应速度

### 角色系统
- **哈利·波特**：勇敢的霍格沃茨学生，擅长魔法和冒险故事
- **苏格拉底**：智慧的哲学家，善于通过提问引导思考
- **爱因斯坦**：好奇的物理学家，热爱科学探索和思想实验

## 📁 项目结构

```
AI-role-playing-website/
├── app/                   # 应用核心模块
├── services/              # 音频和语音服务
├── skills/                # AI智能技能系统
├── config/                # 角色配置
├── scripts/               # 启动和初始化脚本
├── tests/                 # 测试模块
├── data/                  # 数据库存储
├── audio_temp/            # 临时音频文件
├── tts_cache/             # 语音缓存
└── run.py                 # 主启动文件
```

## 🔧 技术栈

- **后端框架**：Streamlit
- **AI 服务**：OpenAI GPT-4o-mini, Whisper, TTS
- **数据库**：SQLite
- **数据验证**：Pydantic
- **音频处理**：pydub, ffmpeg
- **语音组件**：streamlit-audiorecorder